# 在调用 kernel 前对 indices 排序
sorted_indices, sort_order = indices.sort(dim=-1)
# 调用 kernel 使用 sorted_indices
result = kernel(query, key, sorted_indices, ...)
# 结果按 sort_order 还原顺序
final_result = result.scatter(-1, sort_order, result)
